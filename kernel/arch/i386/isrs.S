.intel_syntax noprefix

.section .text

.macro NOERRORCODE_ISR isr_num
    .global ISR\isr_num
ISR\isr_num:
    push 0               # dummy error code
    push \isr_num
    jmp isr_common
.endm

.macro ERRORCODE_ISR isr_num
    .global ISR\isr_num
ISR\isr_num:
    push \isr_num
    jmp isr_common   
.endm

# Manually called macros for each ISR vector
NOERRORCODE_ISR 0
NOERRORCODE_ISR 1
NOERRORCODE_ISR 2
NOERRORCODE_ISR 3
NOERRORCODE_ISR 4
NOERRORCODE_ISR 5
NOERRORCODE_ISR 6
NOERRORCODE_ISR 7
ERRORCODE_ISR 8   # Error code interrupt (double fault, etc.)
NOERRORCODE_ISR 9
ERRORCODE_ISR 10  # Error code interrupt (page fault, etc.)
ERRORCODE_ISR 11  # Error code interrupt
ERRORCODE_ISR 12  # Error code interrupt
ERRORCODE_ISR 13  # Error code interrupt
ERRORCODE_ISR 14  # Error code interrupt
NOERRORCODE_ISR 15
NOERRORCODE_ISR 16
NOERRORCODE_ISR 17  # Error code interrupt (alignment check)
NOERRORCODE_ISR 18
NOERRORCODE_ISR 19
NOERRORCODE_ISR 20
NOERRORCODE_ISR 21  # Error code interrupt (floating point exception)
NOERRORCODE_ISR 22
NOERRORCODE_ISR 23
NOERRORCODE_ISR 24
NOERRORCODE_ISR 25
NOERRORCODE_ISR 26
NOERRORCODE_ISR 27
NOERRORCODE_ISR 28
NOERRORCODE_ISR 29  # Error code interrupt (reserved)
NOERRORCODE_ISR 30  # Error code interrupt (reserved)
NOERRORCODE_ISR 31
NOERRORCODE_ISR 32
NOERRORCODE_ISR 33
NOERRORCODE_ISR 34
NOERRORCODE_ISR 35
NOERRORCODE_ISR 36
NOERRORCODE_ISR 37
NOERRORCODE_ISR 38
NOERRORCODE_ISR 39
NOERRORCODE_ISR 40
NOERRORCODE_ISR 41
NOERRORCODE_ISR 42
NOERRORCODE_ISR 43
NOERRORCODE_ISR 44
NOERRORCODE_ISR 45
NOERRORCODE_ISR 46
NOERRORCODE_ISR 47
NOERRORCODE_ISR 48
NOERRORCODE_ISR 49
NOERRORCODE_ISR 50
NOERRORCODE_ISR 51
NOERRORCODE_ISR 52
NOERRORCODE_ISR 53
NOERRORCODE_ISR 54
NOERRORCODE_ISR 55
NOERRORCODE_ISR 56
NOERRORCODE_ISR 57
NOERRORCODE_ISR 58
NOERRORCODE_ISR 59
NOERRORCODE_ISR 60
NOERRORCODE_ISR 61
NOERRORCODE_ISR 62
NOERRORCODE_ISR 63
NOERRORCODE_ISR 64
NOERRORCODE_ISR 65
NOERRORCODE_ISR 66
NOERRORCODE_ISR 67
NOERRORCODE_ISR 68
NOERRORCODE_ISR 69
NOERRORCODE_ISR 70
NOERRORCODE_ISR 71
NOERRORCODE_ISR 72
NOERRORCODE_ISR 73
NOERRORCODE_ISR 74
NOERRORCODE_ISR 75
NOERRORCODE_ISR 76
NOERRORCODE_ISR 77
NOERRORCODE_ISR 78
NOERRORCODE_ISR 79
NOERRORCODE_ISR 80
NOERRORCODE_ISR 81
NOERRORCODE_ISR 82
NOERRORCODE_ISR 83
NOERRORCODE_ISR 84
NOERRORCODE_ISR 85
NOERRORCODE_ISR 86
NOERRORCODE_ISR 87
NOERRORCODE_ISR 88
NOERRORCODE_ISR 89
NOERRORCODE_ISR 90
NOERRORCODE_ISR 91
NOERRORCODE_ISR 92
NOERRORCODE_ISR 93
NOERRORCODE_ISR 94
NOERRORCODE_ISR 95
NOERRORCODE_ISR 96
NOERRORCODE_ISR 97
NOERRORCODE_ISR 98
NOERRORCODE_ISR 99
NOERRORCODE_ISR 100
NOERRORCODE_ISR 101
NOERRORCODE_ISR 102
NOERRORCODE_ISR 103
NOERRORCODE_ISR 104
NOERRORCODE_ISR 105
NOERRORCODE_ISR 106
NOERRORCODE_ISR 107
NOERRORCODE_ISR 108
NOERRORCODE_ISR 109
NOERRORCODE_ISR 110
NOERRORCODE_ISR 111
NOERRORCODE_ISR 112
NOERRORCODE_ISR 113
NOERRORCODE_ISR 114
NOERRORCODE_ISR 115
NOERRORCODE_ISR 116
NOERRORCODE_ISR 117
NOERRORCODE_ISR 118
NOERRORCODE_ISR 119
NOERRORCODE_ISR 120
NOERRORCODE_ISR 121
NOERRORCODE_ISR 122
NOERRORCODE_ISR 123
NOERRORCODE_ISR 124
NOERRORCODE_ISR 125
NOERRORCODE_ISR 126
NOERRORCODE_ISR 127
NOERRORCODE_ISR 128
NOERRORCODE_ISR 129
NOERRORCODE_ISR 130
NOERRORCODE_ISR 131
NOERRORCODE_ISR 132
NOERRORCODE_ISR 133
NOERRORCODE_ISR 134
NOERRORCODE_ISR 135
NOERRORCODE_ISR 136
NOERRORCODE_ISR 137
NOERRORCODE_ISR 138
NOERRORCODE_ISR 139
NOERRORCODE_ISR 140
NOERRORCODE_ISR 141
NOERRORCODE_ISR 142
NOERRORCODE_ISR 143
NOERRORCODE_ISR 144
NOERRORCODE_ISR 145
NOERRORCODE_ISR 146
NOERRORCODE_ISR 147
NOERRORCODE_ISR 148
NOERRORCODE_ISR 149
NOERRORCODE_ISR 150
NOERRORCODE_ISR 151
NOERRORCODE_ISR 152
NOERRORCODE_ISR 153
NOERRORCODE_ISR 154
NOERRORCODE_ISR 155
NOERRORCODE_ISR 156
NOERRORCODE_ISR 157
NOERRORCODE_ISR 158
NOERRORCODE_ISR 159
NOERRORCODE_ISR 160
NOERRORCODE_ISR 161
NOERRORCODE_ISR 162
NOERRORCODE_ISR 163
NOERRORCODE_ISR 164
NOERRORCODE_ISR 165
NOERRORCODE_ISR 166
NOERRORCODE_ISR 167
NOERRORCODE_ISR 168
NOERRORCODE_ISR 169
NOERRORCODE_ISR 170
NOERRORCODE_ISR 171
NOERRORCODE_ISR 172
NOERRORCODE_ISR 173
NOERRORCODE_ISR 174
NOERRORCODE_ISR 175
NOERRORCODE_ISR 176
NOERRORCODE_ISR 177
NOERRORCODE_ISR 178
NOERRORCODE_ISR 179
NOERRORCODE_ISR 180
NOERRORCODE_ISR 181
NOERRORCODE_ISR 182
NOERRORCODE_ISR 183
NOERRORCODE_ISR 184
NOERRORCODE_ISR 185
NOERRORCODE_ISR 186
NOERRORCODE_ISR 187
NOERRORCODE_ISR 188
NOERRORCODE_ISR 189
NOERRORCODE_ISR 190
NOERRORCODE_ISR 191
NOERRORCODE_ISR 192
NOERRORCODE_ISR 193
NOERRORCODE_ISR 194
NOERRORCODE_ISR 195
NOERRORCODE_ISR 196
NOERRORCODE_ISR 197
NOERRORCODE_ISR 198
NOERRORCODE_ISR 199
NOERRORCODE_ISR 200
NOERRORCODE_ISR 201
NOERRORCODE_ISR 202
NOERRORCODE_ISR 203
NOERRORCODE_ISR 204
NOERRORCODE_ISR 205
NOERRORCODE_ISR 206
NOERRORCODE_ISR 207
NOERRORCODE_ISR 208
NOERRORCODE_ISR 209
NOERRORCODE_ISR 210
NOERRORCODE_ISR 211
NOERRORCODE_ISR 212
NOERRORCODE_ISR 213
NOERRORCODE_ISR 214
NOERRORCODE_ISR 215
NOERRORCODE_ISR 216
NOERRORCODE_ISR 217
NOERRORCODE_ISR 218
NOERRORCODE_ISR 219
NOERRORCODE_ISR 220
NOERRORCODE_ISR 221
NOERRORCODE_ISR 222
NOERRORCODE_ISR 223
NOERRORCODE_ISR 224
NOERRORCODE_ISR 225
NOERRORCODE_ISR 226
NOERRORCODE_ISR 227
NOERRORCODE_ISR 228
NOERRORCODE_ISR 229
NOERRORCODE_ISR 230
NOERRORCODE_ISR 231
NOERRORCODE_ISR 232
NOERRORCODE_ISR 233
NOERRORCODE_ISR 234
NOERRORCODE_ISR 235
NOERRORCODE_ISR 236
NOERRORCODE_ISR 237
NOERRORCODE_ISR 238
NOERRORCODE_ISR 239
NOERRORCODE_ISR 240
NOERRORCODE_ISR 241
NOERRORCODE_ISR 242
NOERRORCODE_ISR 243
NOERRORCODE_ISR 244
NOERRORCODE_ISR 245
NOERRORCODE_ISR 246
NOERRORCODE_ISR 247
NOERRORCODE_ISR 248
NOERRORCODE_ISR 249
NOERRORCODE_ISR 250
NOERRORCODE_ISR 251
NOERRORCODE_ISR 252
NOERRORCODE_ISR 253
NOERRORCODE_ISR 254
NOERRORCODE_ISR 255


.extern ISR_Handler

isr_common:
    pusha
    xor eax,eax
    mov ax,ds
    push eax

    

    mov ax, 0x10
    mov ds,ax
    mov es,ax
    mov fs,ax
    mov gs,ax

    push esp
    
    call ISR_Handler

    

    add esp,4

    pop eax
    mov ds,ax
    mov es,ax
    mov fs,ax
    mov gs,ax

    popa
    add esp,8

    iret
